<?php
// $Id: 

/**
 * @file
 *
 * user2nodeuser_points uses userpoints and user2userpoints api to give users ability to give points to author of a node.
 *
 * @ingroup userpoints_contrib
 */
 
function user2nodeuser_points_block($op = 'list', $delta = '', $edit = array()) {
  // The $op parameter determines what piece of information is being requested.
  switch ($op) {
    case 'list':
      $blocks['user2nodeuser'] = array(
        'info'       => t('Send points to node author'),
      );
      return $blocks;
    case 'view':
      // If $op is "view", then we need to generate the block for display
      // purposes. The $delta parameter tells us which block is being requested.
      switch ($delta) {
        case 'user2nodeuser':
          // The subject is displayed at the top of the block. Note that it
          // should be passed through t() for translation.
          $block['subject'] = t('Award Points');
          // The content of the block is typically generated by calling a custom
          // function.
          $block['content'] = drupal_get_form('user2nodeuser_giveform');
          break;
      }
      return $block;
  }
}

/**
 * A block content function.
 */
function user2nodeuser_giveform(&$form_state,  $account = NULL, $amount = 0, $tid = 0) {
$form = user2userpoints_giveform($form_state); //load the form from user2userpoints module to make modification.
$node = node_load(arg(1));
  unset($form['points']);
  unset($form['0']);  
  $form['amount'] = array(
    '#type'          => 'textfield',
    '#title'         => variable_get(USER2USERPOINTS_AMOUNT_LABEL, 'Amount'),
    '#default_value' => $amount,
    '#size'          => 20,
    '#required'      => TRUE
  );
  $form['to'] = array(
    '#type'      => 'hidden',
    '#value'     => $node->uid,
  );
  $form[] = array(
    '#type'  => 'submit',
    '#value' => t('Give !Points', userpoints_translation()),
    '#weight' => '10'
  );  
  return $form;
}

function user2nodeuser_giveform_validate($form, &$form_state) {
  $form_state['values']['to'] = (int) $form_state['values']['to']; // not sure why I need to do this.
  user2userpoints_giveform_validate($form, $form_state);
}

function user2nodeuser_giveform_submit($form, &$form_state) {
  user2userpoints_giveform_submit($form, $form_state);
 $user = user_load(array('uid'=>$form_state['values']['to']));
  drupal_set_message('You have awarded ' . $user->name . ' ' . $form_state['values']['amount'] .' points');
}